unit AdminCmdLauncher;

interface

uses
  Windows, ShellAPI, SysUtils;

type
  TAdminCmdLauncher = class
  public
    class procedure Launch;
  end;

implementation

function IsChineseLocale: Boolean;
begin
  // 简体中文 LCID 为 $0804
  Result := GetUserDefaultLCID = $0804;
end;

class procedure TAdminCmdLauncher.Launch;
var
  CmdLine, Title: string;
  ExecInfo: TShellExecuteInfo;
  CurrentDir: string;
begin
  // 获取当前工作目录
  CurrentDir := GetCurrentDir;

  // 根据语言环境设置标题
  if IsChineseLocale then
    Title := 'By 不断成长的极光ROM'
  else
    Title := 'By AuroraROM';

  // 构造命令行参数：设置标题 + 切换目录
  CmdLine := Format('/k title %s & cd /d "%s"', [Title, CurrentDir]);

  // 初始化 ShellExecuteInfo 结构体
  ZeroMemory(@ExecInfo, SizeOf(ExecInfo));
  ExecInfo.cbSize := SizeOf(ExecInfo);
  ExecInfo.fMask := SEE_MASK_NOCLOSEPROCESS;
  ExecInfo.Wnd := 0;
  ExecInfo.lpVerb := 'runas'; // 以管理员权限运行
  ExecInfo.lpFile := 'cmd.exe';
  ExecInfo.lpParameters := PChar(CmdLine);
  ExecInfo.lpDirectory := PChar(CurrentDir);
  ExecInfo.nShow := SW_SHOWNORMAL;

  // 执行命令
  if not ShellExecuteEx(@ExecInfo) then
    RaiseLastOSError;

  // 不等待 cmd 退出，程序直接结束
end;

end.

